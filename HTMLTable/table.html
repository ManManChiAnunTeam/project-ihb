<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>IHB 테이블 테스트</title>

    <link rel="stylesheet" href="css/bootstrap.css">

    <style>
        button {
            background: none;
            border: 0;
            outline: 0;
            cursor: pointer;
        }

        .tab_wrap {
            text-align: center;
        }

        .tab_menu_container {
            display: inline;
            padding: 5px;
        }

        .tab_menu_btn {
            width: 80px;
            height: 40px;
            transition: 0.3s all;
        }

        .tab_menu_btn.on {
            border-bottom: 2px solid #0076c0;
            font-weight: 700;
            color: #0076c0;
        }

        .tab_menu_btn:hover {
            color: #0076c0;
        }

        .tab_box_container {
            display: inline;
            font-weight: 300;
        }

        .tab_box {
            display: none;
        }

        .tab_box.on {
            display: contents;
        }

        .id_header {
            width: 10%;
        }

        .title_header {
            width: 60%;
        }

        .tier_header {
            width: 10%;
        }

        .solver_count {
            width: 10%;
        }

        .rate_header {
            width: 10%;
        }

        a:link {
            color: #0076c0;
            text-decoration: none;
        }

        a:visited {
            color: #0076c0;
            text-decoration: none;
        }

        a:hover {
            color: red;
            text-decoration: underline;
        }

        a:active {
            color: white;
            background-color: green;
        }

        th {
            padding: 3px;
        }

        td {
            padding: 3px;
        }

        .pagination {
            flex-wrap: wrap;
        }
    </style>

    <script type="text/javascript" src="js/jquery-3.5.0.js"></script>
</head>

<body>
    <div class="tab_wrap container">
        <div class="tab_menu_container">
            <button class="bronze_tab tab_menu_btn on" type="button">Bronze</button>
            <button class="silver_tab tab_menu_btn" type="button">Silver</button>
            <button class="gold_tab tab_menu_btn" type="button">Gold</button>
            <button class="platinum_tab tab_menu_btn" type="button">Platinum</button>
            <button class="diamond_tab tab_menu_btn" type="button">Diamond</button>
            <button class="ruby_tab tab_menu_btn" type="button">Ruby</button>

            <button class="unrated_tab tab_menu_btn" type="button">Unrated</button>
            <button class="other_tab tab_menu_btn" type="button">번외</button>
        </div>

        <div class="tab_box_container">
            <div class="bronze_box tab_box on">
                <table class="table table-hover" id="bronzeTable">
                    <thead>
                        <tr>
                            <th class="id_header">문제 번호</th>
                            <th class="title_header">제목</th>
                            <th class="tier_header">티어</th>
                            <th class="solver_header">푼 사람 수</th>
                            <th class="rate_header">정답 비율</th>
                        </tr>
                    </thead>

                    <tbody id="B_body">
                    </tbody>
                </table>
                <hr />

                <ul class="pagination justify-content-center pagination-sm" id="B_page">
                </ul>
            </div>

            <div class="silver_box tab_box">
                <table class="table table-hover" id="silverTable">
                    <thead>
                        <tr>
                            <th class="id_header">문제 번호</th>
                            <th class="title_header">제목</th>
                            <th class="tier_header">티어</th>
                            <th class="solver_header">푼 사람 수</th>
                            <th class="rate_header">정답 비율</th>
                        </tr>
                    </thead>

                    <tbody id="S_body">
                    </tbody>
                </table>
                <hr />
                <ul class="pagination justify-content-center pagination-sm" id="S_page">
                </ul>
            </div>

            <div class="gold_box tab_box">
                <table class="table table-hover" id="goldTable">
                    <thead>
                        <tr>
                            <th class="id_header">문제 번호</th>
                            <th class="title_header">제목</th>
                            <th class="tier_header">티어</th>
                            <th class="solver_header">푼 사람 수</th>
                            <th class="rate_header">정답 비율</th>
                        </tr>
                    </thead>

                    <tbody id="G_body">
                    </tbody>
                </table>

                <hr />
                <ul class="pagination justify-content-center pagination-sm" id="G_page">
                </ul>
            </div>

            <div class="platinum_box tab_box">
                <table class="table table-hover" id="platinumTable">
                    <thead>
                        <tr>
                            <th class="id_header">문제 번호</th>
                            <th class="title_header">제목</th>
                            <th class="tier_header">티어</th>
                            <th class="solver_header">푼 사람 수</th>
                            <th class="rate_header">정답 비율</th>
                        </tr>
                    </thead>

                    <tbody id="P_body">
                    </tbody>
                </table>
                <hr />
                <ul class="pagination justify-content-center pagination-sm" id="P_page">
                </ul>
            </div>

            <div class="diamond_box tab_box">
                <table class="table table-hover" id="diamondTable">
                    <thead>
                        <tr>
                            <th class="id_header">문제 번호</th>
                            <th class="title_header">제목</th>
                            <th class="tier_header">티어</th>
                            <th class="solver_header">푼 사람 수</th>
                            <th class="rate_header">정답 비율</th>
                        </tr>
                    </thead>

                    <tbody id="D_body">
                    </tbody>
                </table>

                <hr />
                <ul class="pagination justify-content-center pagination-sm" id="D_page">
                </ul>
            </div>

            <div class="ruby_box tab_box">
                <table class="table table-hover" id="rubyTable">
                    <thead>
                        <tr>
                            <th class="id_header">문제 번호</th>
                            <th class="title_header">제목</th>
                            <th class="tier_header">티어</th>
                            <th class="solver_header">푼 사람 수</th>
                            <th class="rate_header">정답 비율</th>
                        </tr>
                    </thead>

                    <tbody id="R_body">
                    </tbody>
                </table>

                <hr />
                <ul class="pagination justify-content-center pagination-sm" id="R_page">
                </ul>
            </div>

            <div class="unrated_box tab_box">
                <table class="table table-hover" id="unratedTable">
                    <thead>
                        <tr>
                            <th class="id_header">문제 번호</th>
                            <th class="title_header">제목</th>
                            <th class="tier_header">티어</th>
                            <th class="solver_header">푼 사람 수</th>
                            <th class="rate_header">정답 비율</th>
                        </tr>
                    </thead>

                    <tbody id="U_body">
                    </tbody>
                </table>

                <hr />
                <ul class="pagination justify-content-center pagination-sm" id="U_page">
                </ul>
            </div>

            <div class="other_box tab_box">
                <table class="table table-hover" id="otherTable">
                    <thead>
                        <tr>
                            <th class="id_header">문제 번호</th>
                            <th class="title_header">제목</th>
                            <th class="tier_header">티어</th>
                            <th class="solver_header">푼 사람 수</th>
                            <th class="rate_header">정답 비율</th>
                        </tr>
                    </thead>

                    <tbody id="N_body">
                    </tbody>
                </table>

                <hr />
                <ul class="pagination justify-content-center pagination-sm" id="N_page">
                </ul>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        $('.tab_menu_btn').on('click', function () {
            console.log("tab menu clicked");
            $('.tab_menu_btn').removeClass('on');
            $(this).addClass('on');
        });

        $('.bronze_tab').on('click', function () {
            console.log("bronze clicked");
            $('.tab_box').hide();
            $('.bronze_box').show();
        });

        $('.silver_tab').on('click', function () {
            console.log("silver clicked");
            $('.tab_box').hide();
            $('.silver_box').show();
        });

        $('.gold_tab').on('click', function () {
            console.log("gold clicked");
            $('.tab_box').hide();
            $('.gold_box').show();
        });

        $('.platinum_tab').on('click', function () {
            console.log("platinum clicked");
            $('.tab_box').hide();
            $('.platinum_box').show();
        });

        $('.diamond_tab').on('click', function () {
            console.log("diamond clicked");
            $('.tab_box').hide();
            $('.diamond_box').show();
        });

        $('.ruby_tab').on('click', function () {
            console.log("ruby clicked");
            $('.tab_box').hide();
            $('.ruby_box').show();
        });

        $('.unrated_tab').on('click', function () {
            console.log("unrated clicked");
            $('.tab_box').hide();
            $('.unrated_box').show();
        });

        $('.other_tab').on('click', function () {
            console.log("other clicked");
            $('.tab_box').hide();
            $('.other_box').show();
        });
    </script>

    <script type="text/javascript">
        var probDict;
        var tierPrior = { "B": 1, "S": 2, "G": 3, "P": 4, "D": 5, "R": 6, "U": 7, "N": 8 };
        var BAEK_URL = "https://www.acmicpc.net/problem/";

        function SortByTierStr(t1, t2) {
            if (t1.charAt(0) != t2.charAt(0))
                return tierPrior[t1.charAt(0)] < tierPrior[t2.charAt(0)];
            else return t1 < t2;
        }

        async function Initialize() {
            console.log("init...");
            probDict = await ReadFrom('./UnsolvedProbs.json');

            Object.entries(probDict).forEach(([tier, list]) => {
                var tbody = document.getElementById(tier.charAt(0) + "_body");

                list.forEach(function (prob, index, array) {
                    var newRow = tbody.insertRow(-1);

                    var idCell = newRow.insertCell(-1);
                    var titleCell = newRow.insertCell(-1);
                    var tierCell = newRow.insertCell(-1);
                    var solverCell = newRow.insertCell(-1);
                    var rateCell = newRow.insertCell(-1);

                    idCell.innerHTML = prob["id"];
                    titleCell.innerHTML = CreateLink(BAEK_URL + prob["id"], prob["title"]);
                    tierCell.innerHTML = prob["rank"];
                    solverCell.innerHTML = prob["solver_count"];
                    rateCell.innerHTML = prob["ac_rate"];
                });
            });

            Pagination("B_body", "B_page");
            Pagination("S_body", "S_page");
            Pagination("G_body", "G_page");
            Pagination("P_body", "P_page");
            Pagination("D_body", "D_page");
            Pagination("R_body", "R_page");
            Pagination("U_body", "U_page");
            Pagination("N_body", "N_page");

            console.log("done");
        }

        function ReadFrom(path) {
            return new Promise((resolve, reject) => $.get(path, resolve).fail(reject));
        }

        function CreateLink(address, content) {
            return "<a href='" + address + "' target='_blank'>" + content + "</a>";
        }

        function Pagination(bodyId, pageId) {
            var req_num_row = 15;
            var $tr = $("#" + bodyId + " tr");
            var total_num_row = $tr.length;
            var num_pages = 0;
            if (total_num_row % req_num_row == 0) {
                num_pages = total_num_row / req_num_row;
            }
            if (total_num_row % req_num_row >= 1) {
                num_pages = total_num_row / req_num_row;
                num_pages++;
                num_pages = Math.floor(num_pages++);
            }

            var page = $("#" + pageId);

            for (var i = 1; i <= num_pages; i++) {
                page.append("<li class='page-item'><a class='page-link'>" + i + "</a></li>");
                $("#" + pageId + " li:nth-child(1)").addClass("active");
                $("#" + pageId + " a").addClass("pagination-link");
            }

            $tr.each(function (i) {
                jQuery(this).hide();
                if (i + 1 <= req_num_row) {
                    $tr.eq(i).show();
                }
            });

            jQuery("#" + pageId + " a").click('.pagination-link', function (e) {
                e.preventDefault();
                $tr.hide();
                var page = jQuery(this).text();
                var temp = page - 1;
                var start = temp * req_num_row;
                var current_link = temp;

                jQuery("#" + pageId + " li").removeClass("active");
                jQuery(this).parent().addClass("active");

                for (var i = 0; i < req_num_row; i++) {
                    $tr.eq(start + i).show();
                }

            });

        }

        Initialize();
    </script>

    <script type="text/javascript" src="js/bootstrap.js"></script>
</body>

</html>
